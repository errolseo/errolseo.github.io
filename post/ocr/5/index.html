<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"http:\/\/localhost:1313\/",
  "author": {
    "@type": "Person",
    "name": "Errol Seo",
    
    "image": "http://localhost:1313/images/profile.png"
    
  },
  "name":"Errol\u0027s AI blog",
  "description":"CRNN, CTC, SRN",
  "url":"http:\/\/localhost:1313\/post\/ocr\/5\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.147.6 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Errol Seo">
<meta name="keywords" content="">
<meta name="description" content="CRNN, CTC, SRN">


<meta property="og:description" content="CRNN, CTC, SRN">
<meta property="og:type" content="article">
<meta property="og:title" content="[OCR] Scene Text Recognition (1)">
<meta name="twitter:title" content="[OCR] Scene Text Recognition (1)">
<meta property="og:url" content="http://localhost:1313/post/ocr/5/">
<meta property="twitter:url" content="http://localhost:1313/post/ocr/5/">
<meta property="og:site_name" content="Errol&#39;s AI blog">
<meta property="og:description" content="CRNN, CTC, SRN">
<meta name="twitter:description" content="CRNN, CTC, SRN">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2022-04-26T00:00:00">
  
  
    <meta property="article:modified_time" content="2022-04-26T00:00:00">
  
  
  
    
      <meta property="article:section" content="OCR">
    
  
  
    
      <meta property="article:tag" content="Scene Text Recognition">
    
      <meta property="article:tag" content="CRNN">
    
      <meta property="article:tag" content="CTC">
    
      <meta property="article:tag" content="SRN">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="http://localhost:1313/images/profile.png">
  <meta property="twitter:image" content="http://localhost:1313/images/profile.png">





  <meta property="og:image" content="http://localhost:1313/images/OCR/5-2.png">
  <meta property="twitter:image" content="http://localhost:1313/images/OCR/5-2.png">


    <title>[OCR] Scene Text Recognition (1)</title>

    <link rel="icon" href="http://localhost:1313/favicon.png">
    

    

    <link rel="canonical" href="http://localhost:1313/post/ocr/5/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
    
    
    
    <link rel="stylesheet" href="http://localhost:1313/css/style-13exteon7sufvs9gkgrbqttnhf38iqflkvmbceoxxxdkgkvmvpxswczknog.min.css" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7TXCGWW79C"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7TXCGWW79C');
    </script>
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="http://localhost:1313/" aria-label="Go to homepage">Errol&#39;s AI blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="http://localhost:1313/about" aria-label="Open the link: /about">
    
    
    
      
        <img class="header-picture" src="http://localhost:1313/images/profile.png" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <img class="sidebar-profile-picture" src="http://localhost:1313/images/profile.png" alt="Author&#39;s picture" />
        <h4 class="sidebar-profile-name">Errol Seo</h4>
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://localhost:1313/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://localhost:1313/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-list" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://localhost:1313/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-folder-open" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://localhost:1313/about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-user" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/errolseo" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      [OCR] Scene Text Recognition (1)
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-26T00:00:00Z">
        
  April 26, 2022

      </time>
    
    
  
  
    <span>in</span>
    
      <a href="http://localhost:1313/categories/ocr">OCR</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>만약 필자에게 기존 vision task와 Scene Text Recognition(STR)의 차이를 한 문장으로 표현해 달라고 한다면, &lsquo;sequence의 유무&rsquo;라고 대답할 것 같다. STR 모델은 기존 vision classification과는 다른 prediction 형태를 갖는다. 만약 기존과 같은 형태를 가진다면 영어의 알파벳 26자의 5자 조합만 해도 $26^5$이 되어 사실상 모델 생성이 불가능하다. 한글과 한자는 경우의 수가 더 심각해진다. 위의 문제를 해결하기 위한 방법은 다양하게 존재하기 때문에 후술하는 내용에 포함시키려고 한다. STR 모델의 파이프라인에 대해 이해하고, 최종적으로 텍스트의 <strong>seqence</strong>에 대해 이해한다면 추후의 STR 연구에 도움이 될 것이다.</p>
<h4 id="heading">#</h4>
<p>2015년에 공개된 <a href="https://arxiv.org/abs/1507.05717">Convolutional Recurrent Neural Network(CRNN)</a>은 Convolutional, Recurrent, Transcription 3 단계의 레이어로 이루어져 있다. CNN을 이용해 이미지로부터 feature를 추출하고(featurization), RNN을 이용해 feature에 sequence 정보를 추가하여(sequentialization), Connectionist Temporal Classification(CTC)을 이용해 prediction 한다.</p>



<div class="figure center" >
  
    <img class="fig-img" src="http://localhost:1313/images/OCR/5-1.png"  alt="Figure 1. CRNN architecture">
  
   
    <span class="caption">Figure 1. CRNN architecture</span>
  
</div>

<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">inp</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">randn</span><span style="color:#111">([</span><span style="color:#111">batch</span><span style="color:#111">,</span> <span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#111">height</span><span style="color:#111">,</span> <span style="color:#111">width</span><span style="color:#111">])</span> <span style="color:#75715e"># [b, 3, h, w]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cnn_oup</span> <span style="color:#f92672">=</span> <span style="color:#111">cnn_layer</span><span style="color:#111">(</span><span style="color:#111">inp</span><span style="color:#111">)</span> <span style="color:#75715e"># [b, c_c, c_h, c_w]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rnn_inp</span> <span style="color:#f92672">=</span> <span style="color:#111">cnn_oup</span><span style="color:#f92672">.</span><span style="color:#111">permute</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">2</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">view</span><span style="color:#111">(</span><span style="color:#111">b</span><span style="color:#111">,</span> <span style="color:#111">c_w</span><span style="color:#111">,</span> <span style="color:#111">c_c</span> <span style="color:#f92672">*</span> <span style="color:#111">c_h</span><span style="color:#111">)</span> <span style="color:#75715e"># [b, c_w, c_c * c_h]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rnn_oup</span> <span style="color:#f92672">=</span> <span style="color:#111">rnn_layer</span><span style="color:#111">(</span><span style="color:#111">rnn_inp</span><span style="color:#111">,</span> <span style="color:#111">batch_first</span><span style="color:#f92672">=</span><span style="color:#00a8c8">True</span><span style="color:#111">)</span> <span style="color:#75715e"># [b, c_w, hidden_size]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">pred_oup</span> <span style="color:#f92672">=</span> <span style="color:#111">prediction</span><span style="color:#111">(</span><span style="color:#111">rnn_oup</span><span style="color:#111">)</span> <span style="color:#75715e"># [b, c_w, num_labels]</span>
</span></span></code></pre></div><p>모델이 복잡해 보일 수도 있는데 데이터의 flow 자체는 단순하다. 중요한 부분은 최종 출력의 형태다. [c_w, num_labels]에는 convolutional feature의 width에 대한 softmax_value가 들어있다. 즉 이미지 feature를 가로로 1 pixel씩 쪼개어 각각이 의미하는 알파벳을 classifcation하는 것 처럼 보인다. 문제는 위 방식에는 ground truth가 존재하지 않으며, 그로 인해 수 많은 정답이 존재 가능하다는 것이다. 그럼 loss는 어떻게 구하는가.</p>
<p><span class="highlight-text primary">CTC는 Dynamic Programming(DP)을 이용해 모델의 출력값이 정답이 될 수 있는 모든 확률을 계산한 후, 그 확률을 최대로 만들도록 모델을 학습시키는 방법이다.</span> 즉, 정답이 여러 개 존재한다면 그 여러 개에 해당하는 각각의 확률을 모두 구한 후, 그 합이 최대가 되도록 학습하는 것이다. 만약 CTC에 대해 자세히 알고 싶다면 <a href="https://ratsgo.github.io/speechbook/docs/neuralam/ctc">https://ratsgo.github.io/speechbook/docs/neuralam/ctc</a>를 참고하면 좋다.</p>
<p>현재까지도 다양한 모델들이 발표되고 있지만 <strong>featurization, sequentialization, prediction</strong>으로 이루어진 구조는 대부분의 모델에서 채용되고 있다.</p>
<h4 id="heading-1">#</h4>
<p>이미지 featurization에 CNN을 사용하는 것은 대세를 넘어 지배적이었다. 최근 transformer를 이용한 모델들이 준수한 성능을 자랑하며 등장하고 있지만 <a href="https://arxiv.org/abs/1905.11946">EfficientNet</a> 등의 최적화된 모델을 상회한다고 보기는 어렵다. STR은 ResNet과 같은 backbone network를 기반으로 텍스트에 특화된 featurization을 위해 추가적인 모듈을 결합하여 사용한다. Featurization 파트에서 크게 특이한 점은 없었다. 하지만 STR은 이미지를 다루는 task이기 때문에 가장 근본이 되는 파트이다.</p>
<h4 id="heading-2">#</h4>
<p>Sequntialization 파트는 $26^5$의 복잡도를 $25*5$로 바꿔주는 역활을 한다. 텍스트 이미지에 sequence 정보 없이 알파벳 단위의 prediction이 가능한가. 이 부분에 대한 직관은 꽤나 복잡하다. 위에서 CTC를 소개했는데, attention을 이용한 Auto Regressive(AR) 모델도 존재한다.</p>



<div class="figure center" >
  
    <img class="fig-img" src="http://localhost:1313/images/OCR/5-2.png"  alt="Figure 2. Structure of the SRN">
  
   
    <span class="caption">Figure 2. Structure of the SRN</span>
  
</div>

<p>CTC에서는 image feature의 구조를 어느 정도 끝까지 유지했다면, <a href="https://arxiv.org/abs/1603.03915">Sequence Recognition
Network(SRN)</a>에서는 image feature를 sequence feature로 바꿔버린다. 각자의 장단이 존재하지만 STR에 더 적합한 모델은 SRN이라 생각한다. 특히 irregular scene text image에서 발생하는 이슈들에 대해 CTC는 구조적으로 대응하기 어려운 부분이 존재한다.</p>
<h4 id="experience">Experience</h4>
<p>STR의 <strong>featurization, sequentialization, prediction</strong> 각 파트는 독립적이다. 더 좋은 featurization 방법이 있다면 쓰면 되고, 더 나은 sequentialization 방법이 있다면 쓰면 된다. 물론 각각의 성능이 최상이라고 해서 조합했을 때 최적의 성능을 보장하지는 않지만, 파트별로 실험하는데 유리한 구조인 것은 틀림없다. CLOVA AI의 github에서 각 파트의 최적화에 대한 실험을 해볼 수 있는 오픈 소스를 제공한다.</p>
<p>학습 데이터의 경우 직접 만들어도 되지만 LMDB로 잘 정리된 파일이 kaggle에 올라와있어 링크를 첨부한다. 라이센스에 대한 자세한 사항은 필자도 모르기 때문에 개인적인 실험 외에 사용하는 것이면 자세히 알아보고 사용하는 것이 좋다.</p>
<blockquote>
<p>Model framework : <a href="https://github.com/clovaai/deep-text-recognition-benchmark">https://github.com/clovaai/deep-text-recognition-benchmark</a><br>
Data : <a href="https://www.kaggle.com/datasets/nunenuh/clova-deeptext">https://www.kaggle.com/datasets/nunenuh/clova-deeptext</a></p></blockquote>
<p><br>
돌리는 것 자체는 어렵지 않을 것이다. 국내에서 상당히 유명하기 때문에 돌리는 것이 어렵다면 검색을 통해 많은 정보를 얻을 수 있으니 참고하면 좋다.</p>
<h4 id="reference">Reference</h4>
<p>[1] <a href="https://github.com/HCIILAB/Scene-Text-Recognition-Recommendations">https://github.com/HCIILAB/Scene-Text-Recognition-Recommendations</a></p>
<p>[2] B. Shi, et al. <a href="https://arxiv.org/abs/1507.05717">An End-to-End Trainable Neural Network for Image-based Sequence
Recognition and Its Application to Scene Text Recognition</a></p>
<p>[3] B. Shi, et al. <a href="https://arxiv.org/abs/1603.03915">Robust Scene Text Recognition with Automatic Rectification</a></p>
<p>[4] A. Graves, et al. <a href="https://www.cs.toronto.edu/~graves/icml_2006.pdf">Connectionist Temporal Classification: Labelling Unsegmented
Sequence Data with Recurrent Neural Networks</a></p>
<p>[5] J. Baek, et al. <a href="https://arxiv.org/abs/1904.01906">What Is Wrong With Scene Text Recognition Model Comparisons? Dataset and Model Analysis</a></p>

              


            </div>
          </div>
          
            <div id="post-footer" class="post-footer main-content-wrap">
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">Tag</span><br/>
                    
  <a class="tag tag--primary tag--small" href="http://localhost:1313/tags/scene-text-recognition/">Scene Text Recognition</a>

  <a class="tag tag--primary tag--small" href="http://localhost:1313/tags/crnn/">CRNN</a>

  <a class="tag tag--primary tag--small" href="http://localhost:1313/tags/ctc/">CTC</a>

  <a class="tag tag--primary tag--small" href="http://localhost:1313/tags/srn/">SRN</a>

                  </div>
                
              
              <div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="http://localhost:1313/post/ocr/4/" data-tooltip="[OCR] Synthetic Text Image (3)" aria-label="PREVIOUS: [OCR] Synthetic Text Image (3)">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="http://localhost:1313/post/ocr/6/" data-tooltip="[OCR] Scene Text Recognition (2)" aria-label="NEXT: [OCR] Scene Text Recognition (2)">
          
              <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share" >
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </a>
      </li>
      
    
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#main" aria-label="Back to top">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
      </a>
    </li>
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#post-footer" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  </ul>
</div>

              
  <script src="https://utteranc.es/client.js"
    repo="errolseo/blog-comments"
    issue-term="title"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>


            </div>
          
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2025 Errol Seo. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="http://localhost:1313/post/ocr/4/" data-tooltip="[OCR] Synthetic Text Image (3)" aria-label="PREVIOUS: [OCR] Synthetic Text Image (3)">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="http://localhost:1313/post/ocr/6/" data-tooltip="[OCR] Scene Text Recognition (2)" aria-label="NEXT: [OCR] Scene Text Recognition (2)">
          
              <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share" >
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </a>
      </li>
      
    
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#main" aria-label="Back to top">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
      </a>
    </li>
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#post-footer" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  </ul>
</div>

      </div>
      

      
    </div>
    
  <div id="cover" style="background-color:#212F3D"></div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="http://localhost:1313/js/script-qrsoklahg9g5ooyjzl5hng5hxotcoalpfsarimeze2vceouqxhauvdpa1g.min.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        
        
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
        ],
        
        throwOnError : false
      });
  });
</script>



  </body>
</html>

