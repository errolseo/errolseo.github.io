<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/errolseo.github.io\/",
  "author": {
    "@type": "Person",
    "name": "Errol Seo",
    
    "image": "https://errolseo.github.io/images/profile.png"
    
  },
  "name":"Errol\u0027s AI Lab",
  "description":"Qwen3-Next 모델의 핵심인 Gated Delta Networks에 대한 설명",
  "url":"https:\/\/errolseo.github.io\/post\/llm\/2\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.147.6 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Errol Seo">
<meta name="keywords" content="">
<meta name="description" content="Qwen3-Next 모델의 핵심인 Gated Delta Networks에 대한 설명">


<meta property="og:description" content="Qwen3-Next 모델의 핵심인 Gated Delta Networks에 대한 설명">
<meta property="og:type" content="article">
<meta property="og:title" content="Gated Delta Networks (Ongoing)">
<meta name="twitter:title" content="Gated Delta Networks (Ongoing)">
<meta property="og:url" content="https://errolseo.github.io/post/llm/2/">
<meta property="twitter:url" content="https://errolseo.github.io/post/llm/2/">
<meta property="og:site_name" content="Errol&#39;s AI Lab">
<meta property="og:description" content="Qwen3-Next 모델의 핵심인 Gated Delta Networks에 대한 설명">
<meta name="twitter:description" content="Qwen3-Next 모델의 핵심인 Gated Delta Networks에 대한 설명">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2025-09-19T00:00:00">
  
  
    <meta property="article:modified_time" content="2025-09-19T00:00:00">
  
  
  
    
      <meta property="article:section" content="LLM">
    
  
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://errolseo.github.io/images/profile.png">
  <meta property="twitter:image" content="https://errolseo.github.io/images/profile.png">





  <meta property="og:image" content="https://errolseo.github.io/images/LLM/2/1.png">
  <meta property="twitter:image" content="https://errolseo.github.io/images/LLM/2/1.png">


    <title>Gated Delta Networks (Ongoing)</title>

    <link rel="icon" href="https://errolseo.github.io/images/favicon.png">
    

    

    <link rel="canonical" href="https://errolseo.github.io/post/llm/2/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&family=Noto+Sans+KR&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=search" />
    
    
    <link rel="stylesheet" href="https://errolseo.github.io/css/style-rdaicc2g5rh9kvftpgmfinsp9zpjoyb7xhvowsmn2lmzjv69esv8bqqzciu.min.css" />
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://errolseo.github.io/" aria-label="Go to homepage">Errol&#39;s AI Lab</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://errolseo.github.io/about" aria-label="Open the link: /about">
    
    
    
      
        <img class="header-picture" src="https://errolseo.github.io/images/profile.png" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <img class="sidebar-profile-picture" src="https://errolseo.github.io/images/profile.png" alt="Author&#39;s picture" />
        <h4 class="sidebar-profile-name">Errol Seo</h4>
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://errolseo.github.io/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://errolseo.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-list" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://errolseo.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-folder-open" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://errolseo.github.io/about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-user" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/errolseo" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Gated Delta Networks (Ongoing)
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2025-09-19T00:00:00Z">
        
  September 19, 2025

      </time>
    
    
  
  
    <span>in</span>
    
      <a href="https://errolseo.github.io/categories/llm">LLM</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>2025년 9월, Qwen3-Next 모델이 공개되었습니다. 새롭게 공개된 Qwen3-Next-80B-A3B 모델은 기존 Qwen3-32B 모델보다 10.7배 빠르며, 벤치마크 상으로 더 높은 성능을 보여주고 있습니다.</p>
<p>주목할 부분은 10배 이상 빠른 추론 속도인데, Gated Delta Networks라 부르는 선형 트랜스포머 구조를 사용하여 긴 컨텍스트(long context)에서 높은 성능 개선을 이루어냈습니다.</p>



<div class="figure fig-80 center" >
  
    <img class="fig-img" src="https://errolseo.github.io/images/LLM/2/1.png" >
  
  
</div>

<blockquote>
<p>그림 1. Hybrid Architecture (Qwen3-Next)<br>
<a href="https://qwen.ai/blog?id=4074cca80393150c248e508aa62983f9cb7d27cd&amp;from=research.latest-advancements-list">QwenTeam (2025)</a></p></blockquote>
<p>Qwen3-Next 모델은 Gated DelataNet + Gated Attention의 Hybrid 구조 사용하였고, 그림 1에서 Output Gate에 해당하는 output gating mechanism을 이용하여 Attention의 low-rank issues를 감소시키는 등 모델 측면에서 새로운 시도를 많이 도입하였습니다.</p>
<p>그리고 80B의 3.7%에 해당하는 ~3B의 파라미터만을 사용하는 Ultra-Sparse MoE를 성공적으로 학습했습니다. 그리고 다중 토큰 예측(Multi-Token Prediction, MTP)이 가능해졌는데, 기존의 토큰 단위로 출력을 생성하던 것을 여러 개의 토큰 즉, 청크(Chunk) 단위로 추론하는 것이 가능해졌습니다.</p>
<hr>
<h2 id="mamba2">Mamba2</h2>
<p>Gated Delta Network의 경우 Delta Network에 Mamba2의 Gating 능ㄹ력을 추가한 형태입니다. Mamba2가 있다는 것은 Mamba1도 있다는 것이지만 Mamba2를 이해하는데 꼭 필요한 부분은 아니기에 생략하겠습니다.</p>
<p>Mamba2는 기존 트랜스포머의 이차 복잡도(quadratic complexity)를 선형 복잡도(linear complexity)로 변형시키기 위해 고안된 모델입니다. 기본 개념(Concept)은 Residual Connection에서 출발했습니다. 시퀀스(Sequence)를 처리하기 위해서 어텐션이 아닌 Memory와 State 개념을 사용했습니다.</p>
<p>$$
\tag{1} S_t = S_{t-1} + v_t k_t^\intercal \in \R^{d_v \times d_k}
$$</p>
<p>$$
\tag{2} o_t = S_t q_t = \sum^t_{i=1} (v_i k_i^\intercal) q_t = \sum^t_{i=1} v_i (k_i^\intercal q_t) \in \R^{d_v}
$$</p>
<p>$$
\tag{3} O = (QK^\intercal \odot M) V \in \R^{L \times d_v}
$$</p>
<p>수식 1의 형태를 보면 이전 State를 이용해서 최신 State를 업데이트하고 있습니다. 이는 Residual Network에서 자주 보던 형태입니다. 수식 1에서는 Key-Value 쌍만을 이용하지만, 수식 2를 보면 최종 출력은 Query-Key-Value 모두를 사용하기 때문에 수식 3의 표준 트렌스포머 구조와 크게 다르지 않음을 알 수 있다.</p>
<p>이 때, 수식 1의 차원은 $d_v \times d_k$ 이고 수식 2의 차원은 $d_v$ 로 Mamba2의 Attention Score의 차원은 $d_v$ 인 것을 확인 할 수 있다. 수식 3의 표준 트랜스포머의 Attention Score의 차원이 $L \times d_v$ 임으로 이 부분에서 연산량의 차이가 발생합니다.</p>
<p>물론 수식 2는 $o_t$ 의 차원으로 state 갯수인 $o_1, o_2, \cdots, o_t$ 만큼 출력이 존재합니다. 하지만 state의 수는 상수이기 때문에 생략이 가능합니다.</p>
<hr>
<h2 id="delta-network">Delta Network</h2>
<p>Mamba2의 경우는 State의 업데이트 방법은 이전 State에 감쇠치(alpha)를 곱해주는 단순한 형태였습니다. Delta Network는 Delta Update Rule을 이용하여 이전 State에서 필요없는 기억을 지우고 새로운 기억을 쓰면서 메모리를 동적으로 업데이트하는 메커니즘입니다.</p>
<p>$$
\tag{4} S_t = S_{t-1} - \underbrace{(S_{t-1} k_t)k_t^\intercal}_ {v_t^{old}} + \underbrace{(\beta_t v_t + (1 - \beta_t) S_{t-1} k_t)) k_t^\intercal}_ {v_t^{new}} = S_{t-1} (I - \beta_t k_t k_t^\intercal) + \beta_t v_t k_t^\intercal
$$</p>
<p>$S_t$ 업데이트 방법을 자세히 보면 이전 $S_{t-1}$ 에서 $v_t^{old}$ 를 빼고, $v_t^{new}$ 를 더한 값이 새로운 State인 $S_t$ 가 되는 것을 확인할 수 있습니다. 그리고 $v_t^{old}$ 와 $v_t^{new}$ 의 근원은 맨 우측 식에서 확인할 수 있는데, 바로 $(I - \beta_t k_t k_t^\intercal)$ 가 하우스홀더 변환 행렬에 해당하며 이 행렬이 Delta Update Rule의 근원입니다.</p>
<p>본래의 하우스홀더 행렬은 직교 행렬이어서 벡터의 길이를 보존하는 성질을 가집니다. 델타넷은 기존의 하우스홀더 행렬과 유사하게 $k_t k_t^\intercal$ (키 벡터의 외적 항)을 포함하고 있지만, 직교성을 보존하지 않는다는 차이가 있습니다. 이는 벡터의 길이를 보존하지 않으므로, 델타넷이 단순히 반사(reflection)하는 것이 아니라 정보를 선택적으로 지우거나 더하는 변환을 수행할 수 있게 합니다.</p>
<hr>
<h2 id="gated-delta-network">Gated Delta Network</h2>
<p>Gated Delta Network는 Delta Network의 구조에 Mamba2의 Gating 메커니즘을 추가한 형태입니다.</p>
<p>$$
\tag{5} S_t = S_{t-1} (\alpha_t (I - \beta_t k_t k_t^\intercal)) + \beta_t v_t k_t^\intercal
$$</p>
<p>수식 5는 수식 4에서 $\alpha$ 항이 추가됐을 뿐인 구조입니다. 의아할 수 있는 부분은 Delta Network는 특정 부분만을 잊기 위해서 고안된 모델인데 거기에 전체를 잊을 수 있는 Gating 메커니즘을 추가한다는 역설적인 부분입니다. 이는 Delta Network를 바라보는 관점의 차이에서 발생하는 문제입니다.</p>
<p>Delta Network는 하우스홀더 행렬을 사용하여 정보를 선택적으로 지우거나 더합니다. 하지만 이는 이전 State의 정보를 효율적으로 다음 State로 넘기기 위해서 진행하는 행위입니다. 만약 이러한 번형이 없이 State값을 계속해서 누적해 나간다면 모델의 gradient가 소실되거나 폭발할 위험이 있습니다.</p>
<p>Delta Network는 이러한 gradient 소실/폭발 문제를 해소하면서도 이전 State의 정보를 다음 State로 효과적으로 전달하기 위해 고안된 방법입니다. 하지만 이는 이전 State의 정보를 보존하는데는 탁월한 능력을 보여주지만, 잊어버리는데 있어서는 효율적이지 못합니다. 기본적으로 보존에 포커싱이 되어있기 때문입니다. 그래서 효율적으로 잊어버리기 위해 게이팅 능력을 추가해 주는 것 입니다.</p>
<hr>
<h2 id="chunkwise-parallel-form">Chunkwise parallel form</h2>
<p>이러한 선형 트랜스포머는 긴 컨텍스트 추론 시에 표준 트랜스포머보다 높은 처리량(throughput)을 보장합니다. 하지만 학습 시에는 재귀적인 방식($S_t$ 의 연산이 $S_{t-1}$에 의존) 때문에 계산이 너무 비효율적이라서 많은 주목을 받지는 못했습니다.</p>
<p>그러다가 2024년 Yang et al. 이라는 연구자들이 하드웨어 효율적인 청크 방식(chunkwise) 훈련 알고리즘을 개발하면서 상황이 바뀌었습니다.</p>
<p>기존 Mamba2나 Delta Network는 State를 업데이트 하기 위해서는</p>
<hr>
<h2 id="결론">결론</h2>
<p>Songlim Yang 연구자의 기여(contribution)에 의해 LLM에 새로운 패러다임이 제시되었고, Qwen팀이 그것을 유의미한 결과로 만들어낸 것 같습니다. 이로 인해 학습에 들어가는 비용이 많이 줄어들었고, 모델의 추론 속도와 메모리 사용량 또한 획기적으로 줄어들었습니다.</p>
<p>개인적으로 기존 트랜스포머의 구조보다 훨씬 합리적(reasonable)이라고 느끼는 것이 Residual Network의 기본 이념과 동일한 구조를 채택하고 있다는 부분입니다. Scaled Dot-Product Attention의 경우, 결과로 증명하기는 했지만 실제로 attention score를 visualization 해보면 우리가 아는 예상하는 형태와 많이 달랐으며, 이를 auto regressive model로 활용하기 위해 masking을 사용하는 것도 자연스럽지 못한 부분이었습니다.</p>
<p>하지만 선형 트랜스포머의 경우 이러한 문제점들에서 비교적 자유로워 보여서 훨씬 자연스러운 모델 구조처럼 보입니다. 저는 앞으로 대부분의 모델이 선형 트랜스포머를 채택할 것으로 예상하고 있습니다.</p>
<hr>
<h4 id="reference">Reference</h4>
<p>Yang, Songlim (2024) | <a href="https://arxiv.org/pdf/2406.06484">Parallelizing Linear Transformers with the Delta Rule over Sequence Length</a></p>
<p>Yang, Songlim (2024) | <a href="https://arxiv.org/abs/2412.06464">GATED DELTA NETWORKS: IMPROVING MAMBA2 WITH DELTA RULE</a></p>
<p>Qwen Team (2025) | <a href="https://qwen.ai/blog?id=4074cca80393150c248e508aa62983f9cb7d27cd&amp;from=research.latest-advancements-list">Qwen3-Next: Towards Ultimate Training &amp; Inference Efficiency</a></p>
<hr>

              


            </div>
          </div>
          
            <div id="post-footer" class="post-footer main-content-wrap">
              
              
  <script src="https://utteranc.es/client.js"
    repo="errolseo/blog-comments"
    issue-term="title"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>


              <div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://errolseo.github.io/post/llm/1/" data-tooltip="Scaling Laws" aria-label="PREVIOUS: Scaling Laws">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share" >
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </a>
      </li>
      
    
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#main" aria-label="Back to top">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
      </a>
    </li>
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#post-footer" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  </ul>
</div>

            </div>
          
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2025 Errol Seo. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://errolseo.github.io/post/llm/1/" data-tooltip="Scaling Laws" aria-label="PREVIOUS: Scaling Laws">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share" >
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </a>
      </li>
      
    
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#main" aria-label="Back to top">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
      </a>
    </li>
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#post-footer" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  </ul>
</div>

      </div>
      

      
    </div>
    
  <div id="cover" style="background-color:#212F3D"></div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://errolseo.github.io/js/script-g1mx9g79aue54bvmjcsjeh2iff3wfw035cumxbsjtmd5wibkqerfmfmol.min.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>



  </body>
</html>

